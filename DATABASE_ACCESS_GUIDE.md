# Database Access Guide - Imperra Energy Website

## Overview
All contact form submissions are stored in MongoDB database named `test_database` in the `contact_inquiries` collection.

---

## Method 1: API Endpoints (Recommended - Easiest)

### View All Contact Inquiries
```bash
curl http://localhost:8001/api/contact-inquiries
```

Or open in browser:
```
http://localhost:8001/api/contact-inquiries
```

### Filter by Status
```bash
# View only new inquiries
curl http://localhost:8001/api/contact-inquiries?status=new

# View contacted inquiries
curl http://localhost:8001/api/contact-inquiries?status=contacted

# View converted inquiries
curl http://localhost:8001/api/contact-inquiries?status=converted
```

### View Specific Inquiry by ID
```bash
curl http://localhost:8001/api/contact-inquiries/{inquiry-id}
```

### Pretty JSON Format
```bash
curl -s http://localhost:8001/api/contact-inquiries | python3 -m json.tool
```

---

## Method 2: MongoDB Command Line

### Connect to MongoDB
```bash
mongosh test_database
```

### View All Contact Inquiries
```bash
mongosh test_database --eval "db.contact_inquiries.find()"
```

### View with Pretty Formatting
```bash
mongosh test_database --eval "db.contact_inquiries.find().pretty()"
```

### Count Total Inquiries
```bash
mongosh test_database --eval "db.contact_inquiries.countDocuments()"
```

### View Only New Inquiries
```bash
mongosh test_database --eval "db.contact_inquiries.find({status: 'new'})"
```

### View Latest 10 Inquiries (Sorted by Date)
```bash
mongosh test_database --eval "db.contact_inquiries.find().sort({timestamp: -1}).limit(10)"
```

### Search by Email
```bash
mongosh test_database --eval "db.contact_inquiries.find({email: 'test@example.com'})"
```

### Search by Project Type
```bash
mongosh test_database --eval "db.contact_inquiries.find({projectType: 'Solar Park EPC'})"
```

---

## Method 3: Interactive MongoDB Shell

### Enter MongoDB Shell
```bash
mongosh test_database
```

Then you can run queries interactively:
```javascript
// View all inquiries
db.contact_inquiries.find()

// Count inquiries
db.contact_inquiries.countDocuments()

// Find by status
db.contact_inquiries.find({status: "new"})

// Find by company name (case insensitive)
db.contact_inquiries.find({company: /TATA/i})

// View only specific fields
db.contact_inquiries.find({}, {name: 1, email: 1, phone: 1, projectType: 1})

// Update inquiry status
db.contact_inquiries.updateOne(
  {id: "9e7bc30f-0f3a-4aea-9d77-194ae20de1e7"},
  {$set: {status: "contacted"}}
)

// Delete an inquiry (be careful!)
db.contact_inquiries.deleteOne({id: "inquiry-id-here"})

// Exit shell
exit
```

---

## Method 4: MongoDB Compass (GUI Tool)

If you want a graphical interface:

1. **Download MongoDB Compass**: https://www.mongodb.com/try/download/compass
2. **Connection String**: `mongodb://localhost:27017`
3. **Database**: `test_database`
4. **Collection**: `contact_inquiries`

---

## Data Structure

Each contact inquiry has the following fields:

```json
{
  "_id": "ObjectId (auto-generated by MongoDB)",
  "id": "UUID (unique identifier)",
  "name": "Full Name",
  "email": "email@example.com",
  "phone": "+91 XXXXX XXXXX",
  "company": "Company Name (optional)",
  "projectType": "Solar Park EPC | Rooftop Solar EPC | Solar Finance & Investment | Other",
  "capacity": "Expected capacity in MW (optional)",
  "message": "Project details and requirements (optional)",
  "timestamp": "ISO Date (when inquiry was submitted)",
  "status": "new | contacted | converted"
}
```

---

## Useful MongoDB Queries

### Export All Inquiries to JSON File
```bash
mongoexport --db=test_database --collection=contact_inquiries --out=inquiries.json
```

### Export All Inquiries to CSV
```bash
mongoexport --db=test_database --collection=contact_inquiries --type=csv --fields=name,email,phone,company,projectType,capacity,message,timestamp,status --out=inquiries.csv
```

### Backup the Collection
```bash
mongodump --db=test_database --collection=contact_inquiries --out=/backup/
```

### Restore from Backup
```bash
mongorestore --db=test_database --collection=contact_inquiries /backup/test_database/contact_inquiries.bson
```

---

## Managing Inquiries

### Update Inquiry Status via API (Future Enhancement)
You can add a PATCH endpoint to update inquiry status:
```bash
curl -X PATCH http://localhost:8001/api/contact-inquiries/{id} \
  -H "Content-Type: application/json" \
  -d '{"status": "contacted"}'
```

### Update Inquiry Status via MongoDB
```bash
mongosh test_database --eval 'db.contact_inquiries.updateOne({id: "inquiry-id"}, {$set: {status: "contacted"}})'
```

---

## Environment Variables

Database connection details are stored in `/app/backend/.env`:
```
MONGO_URL=mongodb://localhost:27017
DB_NAME=test_database
```

---

## Monitoring New Inquiries

### Real-time Watch (Linux/Mac)
```bash
watch -n 5 'curl -s http://localhost:8001/api/contact-inquiries | python3 -m json.tool'
```

### Count Inquiries by Status
```bash
mongosh test_database --eval '
db.contact_inquiries.aggregate([
  {$group: {_id: "$status", count: {$sum: 1}}}
])
'
```

---

## Troubleshooting

### Can't Connect to MongoDB?
```bash
# Check if MongoDB is running
sudo systemctl status mongod

# Start MongoDB if not running
sudo systemctl start mongod
```

### Backend API Not Responding?
```bash
# Check backend logs
tail -f /var/log/supervisor/backend.err.log

# Restart backend
sudo supervisorctl restart backend
```

---

## Security Notes

- In production, add authentication to MongoDB
- Add API authentication/authorization for contact inquiry endpoints
- Consider adding rate limiting to prevent spam
- Add email notifications when new inquiries arrive
- Implement admin dashboard to manage inquiries

---

## Next Steps

Consider building:
1. Admin dashboard to view and manage inquiries
2. Email notifications for new inquiries
3. CRM integration (Salesforce, HubSpot, etc.)
4. Export functionality (CSV, Excel)
5. Inquiry status workflow (new → contacted → quoted → converted)
